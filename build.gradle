plugins {
    id 'net.nemerosa.versioning' version '2.6.1'
}

// Apply the java plugin to add support for Java
apply plugin: 'java'
apply plugin: 'scala'
apply plugin: 'maven'
apply plugin: 'signing'
apply plugin: 'application'

group = 'io.rsocket'
archivesBaseName = "rsocket-tck"
mainClassName = "io.rsocket.tckdrivers.main.Main"

description = "RSocket TCK"

sourceCompatibility = 1.8
targetCompatibility = 1.8

ext {
    scalaVersion = '2.11.2'
    scalaLibVersion = '2.11'
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}

repositories {
    jcenter()
    maven { url "https://jitpack.io" }
    maven { url "http://repo.maven.apache.org/maven2" }
    maven { url 'http://repo.spring.io/milestone' }
    maven { url 'https://oss.jfrog.org/libs-release' }
}

jar {
    manifest {
        attributes "Main-Class": "$mainClassName"
    }

    from {
        configurations.compile.collect { it.isDirectory() ? it : zipTree(it) }
    }
}

dependencies {
    compile 'io.rsocket:rsocket-transport-netty:0.9.10'
    compile 'io.rsocket:rsocket-transport-local:0.9.10'
    compile "io.projectreactor.ipc:reactor-netty:0.7.0.RELEASE"

    compile 'io.airlift:airline:0.8'
    compile "org.json4s:json4s-native_$scalaLibVersion:3.5.3"
    compile "org.scala-lang:scala-library:$scalaVersion"
    compile "org.scala-lang:scala-reflect:$scalaVersion"
    compile 'org.apache.commons:commons-lang3:3.6'
    compile 'commons-io:commons-io:2.5'
    compile "com.fasterxml.jackson.core:jackson-core:2.9.1"
    compile "com.fasterxml.jackson.core:jackson-databind:2.9.1"
    compile "io.reactivex.rxjava2:rxjava:2.1.3"

    compile "junit:junit:4.12"
    compile "org.mockito:mockito-core:2.10.0"
    compile "org.hamcrest:hamcrest-library:1.3"
    compile "org.slf4j:slf4j-log4j12:1.7.25"
    compile "io.projectreactor:reactor-test:3.1.0.RELEASE"
}

task packageTests(type: Jar) {
    from sourceSets.test.output
    classifier = 'tests'
}

task javadocJar(type: Jar) {
    classifier = 'javadoc'
    from javadoc
}

task sourcesJar(type: Jar) {
    classifier = 'sources'
    from sourceSets.main.allSource
}

artifacts {
    archives javadocJar, sourcesJar, packageTests, jar
}
